[trend_scenarios]
list = ema_bull_stack, ema_bear_stack,
       adx_strong_up, adx_weak,
       macd_bull_cross, macd_hist_rising,
       roc_vs_atr_ok,
       atr_penalty_8, atr_penalty_10, atr_penalty_15,
       poc_far,
       ema_transitioning, retest_ema20, ema_compression,
       adx_fading, adx_reversal, adx_wrong_di_up,
       macd_bear_cross, macd_whipsaw, macd_failed_zero_cross,
       roc_momentum_strong, atr_reversal_signal,
       ema_breakout_vol, ema_retest_fail,
       squeeze_breakout, volatility_compression_trend,
       bullish_divergence, bearish_divergence

[trend_scenario.ema_bull_stack]
when = (ema10 > ema20) and (ema20 > ema50) and (close > ema20)
score = +40

[trend_scenario.ema_bear_stack]
when = (ema10 < ema20) and (ema20 < ema50) and (close < ema20)
score = +40

[trend_scenario.adx_strong_up]
when = (adx14 >= 25) and (adx14 > adx14_prev) and (dip_gt_dim)
score = +20

[trend_scenario.adx_weak]
when = (adx14 < 20)
score = -5

[trend_scenario.macd_bull_cross]
when = (macd_line > macd_sig) and (hist_diff > 0)
score = +15
bonus_when = (macd_line_prev <= 0) and (macd_line > 0)
bonus = +5

[trend_scenario.macd_hist_rising]
when = (hist_diff >= 0)
score = +10

[trend_scenario.roc_vs_atr_ok]
when = (roc_abs_over_atr_ratio >= 0.7)
score = +5

[trend_scenario.atr_penalty_8]
when = (atr_pct > 8.0)
score = -5

[trend_scenario.atr_penalty_10]
when = (atr_pct > 10.0)
score = -10

[trend_scenario.atr_penalty_15]
when = (atr_pct > 15.0)
score = -15

[trend_scenario.poc_far]
when = (poc_dist_atr >= 2.0)
score = +5


[trend_scenario.ema_transitioning]
when = (ema10 > ema50) and (ema20 > ema50) and not (ema10 > ema20)
score = +15

[trend_scenario.retest_ema20]
when = (close > ema20) and (low < ema20)
score = +10

[trend_scenario.ema_compression]
when = ((ema10 - ema50) / ema50) < 0.01
score = +5

[trend_scenario.adx_fading]
when = (adx14 >= 25) and (adx14 < adx14_prev)
score = -10

[trend_scenario.adx_reversal]
when = (adx14 < 20) and (adx14 > adx14_prev)
score = +5

[trend_scenario.adx_wrong_di_up]
when = (adx14 >= 25) and not (dip_gt_dim)
score = -10

[trend_scenario.macd_bear_cross]
when = (macd_line < macd_sig) and (hist_diff < 0)
score = -15

[trend_scenario.macd_whipsaw]
when = (hist_diff > 0) and (macd_line < 0) and (macd_line_prev > 0)
score = -5

[trend_scenario.macd_failed_zero_cross]
when = (macd_line > 0) and (macd_line_prev <= 0) and (hist_diff < 0)
score = -5


[trend_scenario.roc_momentum_strong]
when = (roc_abs_over_atr_ratio >= 1.0)
score = +10


[trend_scenario.atr_reversal_signal]
when = (adx14 >= 25) and (atr_pct < atr_pct_prev)
score = -5


[trend_scenario.ema_breakout_vol]
when = (close > ema20) and (open < ema20) and (volume > (2 * volume_avg_20))
score = +10

[trend_scenario.ema_retest_fail]
when = (low < ema20) and (close < ema20) and (close_prev > ema20)
score = -10

[trend_scenario.squeeze_breakout]
when = (squeeze_flag == 1) and (adx14 > adx14_prev)
score = +15


[trend_scenario.volatility_compression_trend]
when = (adx14 >= 25) and (bb_width_pct < bb_width_pct_prev)
score = +5


[trend_scenario.bullish_divergence]
when = (close < close_prev_n) and (rsi_now > rsi_prev_n)
score = +10


[trend_scenario.bearish_divergence]
when = (close > close_prev_n) and (rsi_now < rsi_prev_n)
score = -10

[trend_ml]
enabled = true
target_name = trend_ml.target.bull_2pct_4h
version = xgb_v1
calibration_table = indicators.trend_calibration_4h
blend_weight = 0.35
ml_veto_if_prob_lt = 0.35
ml_soften_veto_if_prob_ge = 0.65

[trend]
clamp_low = 0
clamp_high = 100
write_scenarios_debug = false
min_bars = 120
