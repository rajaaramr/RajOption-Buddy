[trend]
rules_mode = additive
clamp_low = 0
clamp_high = 100
min_bars = 120
ema_fast=10
ema_mid=20
ema_slow=50
adx_main=14
adx_fast=9
roc_win=5
atr_win=14
poc_align_bonus=5.0
div_lookback=5
bb_win=20
bb_k=2.0
kc_win=20
kc_mult=1.5
vol_avg_win=20


rules_mode=additive        ; additive | override
clamp_low=0
clamp_high=100
write_scenarios_debug=false
min_bars=120

[scenarios]
list = ema_bull_stack, ema_bear_stack,
       adx_strong_up, adx_weak,
       macd_bull_cross, macd_hist_rising,
       roc_vs_atr_ok,
       atr_penalty_8, atr_penalty_10, atr_penalty_15,
       poc_far,
       ema_transitioning, retest_ema20, ema_compression,
       adx_fading, adx_reversal, adx_wrong_di_up,
       macd_bear_cross, macd_whipsaw, macd_failed_zero_cross,
       roc_momentum_strong, atr_reversal_signal,
       ema_breakout_vol, ema_retest_fail,
       squeeze_breakout, volatility_compression_trend,
       bullish_divergence, bearish_divergence

[scenario.ema_bull_stack]
when = (ema10 > ema20) and (ema20 > ema50) and (close > ema20)
score = +40

[scenario.ema_bear_stack]
when = (ema10 < ema20) and (ema20 < ema50) and (close < ema20)
score = +40

[scenario.adx_strong_up]
when = (adx14 >= 25) and (adx14 > adx14_prev) and (dip_gt_dim)
score = +20

[scenario.adx_weak]
when = (adx14 < 20)
score = -5

[scenario.macd_bull_cross]
when = (macd_line > macd_sig) and (hist_diff > 0)
score = +15
bonus_when = (macd_line_prev <= 0) and (macd_line > 0)
bonus = +5

[scenario.macd_hist_rising]
when = (hist_diff >= 0)
score = +10

[scenario.roc_vs_atr_ok]
when = (roc_abs_over_atr_ratio >= 0.7)
score = +5

[scenario.atr_penalty_8]
when = (atr_pct > 8.0)
score = -5

[scenario.atr_penalty_10]
when = (atr_pct > 10.0)
score = -10

[scenario.atr_penalty_15]
when = (atr_pct > 15.0)
score = -15

[scenario.poc_far]
when = (poc_dist_atr >= 2.0)
score = +5


[scenario.ema_transitioning]
when = (ema10 > ema50) and (ema20 > ema50) and not (ema10 > ema20)
score = +15

[scenario.retest_ema20]
when = (close > ema20) and (low < ema20)
score = +10

[scenario.ema_compression]
when = ((ema10 - ema50) / ema50) < 0.01
score = +5

[scenario.adx_fading]
when = (adx14 >= 25) and (adx14 < adx14_prev)
score = -10

[scenario.adx_reversal]
when = (adx14 < 20) and (adx14 > adx14_prev)
score = +5

[scenario.adx_wrong_di_up]
when = (adx14 >= 25) and not (dip_gt_dim)
score = -10

[scenario.macd_bear_cross]
when = (macd_line < macd_sig) and (hist_diff < 0)
score = -15

[scenario.macd_whipsaw]
when = (hist_diff > 0) and (macd_line < 0) and (macd_line_prev > 0)
score = -5

[scenario.macd_failed_zero_cross]
when = (macd_line > 0) and (macd_line_prev <= 0) and (hist_diff < 0)
score = -5


[scenario.roc_momentum_strong]
when = (roc_abs_over_atr_ratio >= 1.0)
score = +10


[scenario.atr_reversal_signal]
when = (adx14 >= 25) and (atr_pct < atr_pct_prev)
score = -5


[scenario.ema_breakout_vol]
when = (close > ema20) and (open < ema20) and (volume > (2 * volume_avg_20))
score = +10

[scenario.ema_retest_fail]
when = (low < ema20) and (close < ema20) and (close_prev > ema20)
score = -10

[scenario.squeeze_breakout]
when = (squeeze_flag == 1) and (adx14 > adx14_prev)
score = +15


[scenario.volatility_compression_trend]
when = (adx14 >= 25) and (bb_width_pct < bb_width_pct_prev)
score = +5


[scenario.bullish_divergence]
when = (close < close_prev_n) and (rsi_now > rsi_prev_n)
score = +10


[scenario.bearish_divergence]
when = (close > close_prev_n) and (rsi_now < rsi_prev_n)
score = -10


[trend_ml]
enabled = true
blend_weight = 0.35