; =========================
;  indicators.ini  (clean)
; =========================

[base]
source_table_spot    = market.spot_candles
source_table_futures = market.futures_candles
base_interval        = 15m
run_id_prefix        = ind_run

[frames]
spot_table    = indicators.spot_frames
futures_table = indicators.futures_frames
allowed_intervals = 15m,30m,60m,90m,120m,240m

[symbols]
list = TCS, INFY, HDFCBANK, RELIANCE, TECHM, LT, SBIN, ICICIBANK, KOTAKBANK, M_M, TATASTEEL, TATAMOTORS, ITC, HCLTECH

; ---- Global timeframes available in the system
[timeframes]
list = 15m,30m,60m,90m,120m,240m

; =========================
;  Sources (DB tables / views)
; =========================
[sources]
futures_table   = market.futures_candles
spot_table      = market.spot_candles
indicators_view = indicators.values
symbol_col      = symbol
ts_col          = ts
timeframe_col   = interval

; =========================
;  Classic Indicators worker
; =========================
[indicators]
rsi = on
ema = on
macd = on
adx = on
roc = on
atr = on
mfi = on
sma = off

[periods]
rsi  = 14
ema  = 5,10,20,50
macd = 12,26,9
adx  = 14
roc  = 14
atr  = 14
mfi  = 14
sma  = 5,10,20,50

; Optional backward-compat (some older scripts read [metrics]/[params]).
; Keep in sync with [indicators]/[periods].
[metrics]
RSI   = true
RMI   = true
MACD  = true
ADX   = true
ROC   = true
ATR   = true
MFI   = true
EMA   = 5,10,20,50
CCI   = true
STOCH = true
PSAR  = true


[params]
RSI.length   = 14
RMI.length   = 14
RMI.momentum = 5
MACD.fast    = 12
MACD.slow    = 26
MACD.signal  = 9
ADX.length   = 14
ROC.length   = 14
ATR.length   = 14
MFI.length   = 14
CCI.length   = 20
STOCH.k      = 14
STOCH.d      = 3
PSAR.af_step = 0.02
PSAR.af_max  = 0.20

OBV.ema      = 20
OBV.z_short  = 20
OBV.z_long   = 100

; =========================
;  VP + Black Blocks worker
; =========================
[vpbb]
; Data scope & identity
lookback_days = 180
market_kind   = both          ; "futures" or "spot"
run_id        = vpbb_run
source        = vp_bb
BACKFILL_BARS = 100           ; Reduced for performance (was 2000)

; If set, overrides [timeframes].list for VP/BB only:
; tf_list = 15m,30m,60m,120m,240m

; Volume Profile
vp_value_pct     = 0.70
use_typical_price= true
vp_decay_alpha   = 0.00

; Block Builder (base thresholds)
vol_ma_len     = 24       ; shorter lookback for volume baseline on 15m
vol_pct_thr    = 45       ; base lower; auto_scale will raise this when ATR regime is hot
csv_z_thr      = 0.30     ; allow slightly smaller CSV surprises on short TF
obv_delta_min  = 0        ; let auto_scale set data-driven threshold (≈1.5× OBVΔ std)
min_blocks     = 2        ; keep 2; raise to 3 only if over-triggering
dyn_volpct_low  = 35      ; widen adaptation band...
dyn_volpct_high = 70      ; ...so quiet days don’t null you out
vp_bins              = 40 ; fewer bins → less sparsity on 15m windows
score_hi       = 6.5

; Scoring & diagnostics
pick_best_run     = true
write_diagnostics = true

; Adaptive / regime knobs
auto_scale           = true
regime_lookback_days = 200
std_lookback_days    = 200
dyn_volpct_low       = 40
dyn_volpct_high      = 65

; Momentum inputs for block scoring
rsi_len   = 14
macd_fast = 12
macd_slow = 26
macd_sig  = 9

; EMA refs for location bonus
ema_refs = 20,50,200

; VWAP / Anchored VWAP diagnostics
vwap_anchor_mode = none          ; none | swing | days
vwap_anchor_days = 20

; =========================
;  Confidence (price/volume ML + penalties)
; =========================
[confidence]
; Timeframes used for confidence models
[confidence]
tfs = 15m,30m,60m,120m,240m
tf_weights = 0.35,0.25,0.25,0.15
lookback_days = 180

; HMM/NB gate (if artifacts missing, heuristic gate kicks in)
states = 3
barrier_atr_k = 1.0
horizon_bars = 30m:8,60m:5,120m:3
laplace_alpha = 2.0

; Thresholds used in features/penalties
oi_z_hi          = 1.5
vp_poc_atr_thr   = 0.20
squeeze_bw_pct   = 20.0
bb_score_hi      = 6.5

; Penalties/bonuses on logit
lambda_poc     = 0.25
lambda_crowd   = 0.35
lambda_squeeze = 0.20

; OI integration mode & knobs for OI worker
oi_integration = bayes          ; additive | bayes
bayes_k = 0.50
bayes_m = 0.75
mtf_oi_weights = 15m:0.1,30m:0.2,60m:0.30,120m:0.40
mtf_align_gate = 0.60
mtf_conflict_cap = 0.60

; Identity
run_id = conf_run
source = conf_hmm_bayes

; =========================
;  OI-specific thresholds (used by update_confidence_oi.py)
; =========================
[oi]
window          = 20
persistence_min = 0.60
voi_eff_min     = 0.05
oi_turnover_low = 0.10
oi_turnover_high= 1.20
roll_dampen     = 0.50
basis_confirm   = 1
squeeze_bw_pct  = 20.0

; roll detection aides
roll_pdrop = 0.30
roll_z     = 2.0

; =========================
;  Composite & fusion scorer
; =========================
[composite.weights]
trend=0.25
momentum=0.25
quality=0.15
flow=0.15
structure=0.15
consensus_bonus_max=10

[composite.veto]
short_rsi_gt=60
short_rmi_gt=55
short_mfi_gt=55
long_rsi_lt=40
long_rmi_lt=45
long_mfi_lt=45
adx_min=20
veto_penalty=10
chop_penalty=5

[composite.tfs]
list=15m,30m,60m,90m,120m,240m
mtf_weights=15m:0.1,30m:0.3,60m:0.3,90m:0.2,120m:0.1

[composite.general]
score_cap=100

[ml]
enabled = 1
featureset = v1

[indicators]
ml_export_enabled = true